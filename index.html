<!DOCTYPE html>
<html>
<head>
    <title>–ü—Ä–æ–≥—Ä–µ—Å—Å</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            height: 100vh;
            background: #f5f7fa;
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        .status-item {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
        }
        .loading {
            text-align: center;
            color: #3498db;
            font-size: 18px;
        }
        button {
            width: 100%;
            padding: 14px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 style="text-align: center; color: #2c3e50;">–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h2>
        <div id="status">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
        </div>
        <button onclick="loadData(true)">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>

    <script>
        // ================== –ù–ê–°–¢–†–û–ô–ö–ò ==================
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzeC5R3WmU0clDybZCnxkcs_wPCub-gf4UMRKzrKsj2KPw_U4FafMgBYGhIzzu-yjoIAQ/exec'; // –ó–∞–º–µ–Ω–∏—Ç—å!
        // ================================================

        let userData = null;
        const tg = window.Telegram.WebApp;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        tg.expand();
        tg.ready();

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö
        const initUser = async () => {
            try {
                const user = tg.initDataUnsafe.user;
                if (!user) throw new Error("User not found");
                
                // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chatId: String(user.id), // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤ —Å—Ç—Ä–æ–∫—É!
                        username: user.username || '–ë–µ–∑ –∏–º–µ–Ω–∏'
                    })
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
            }
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        const loadData = async (force = false) => {
            try {
                document.getElementById('status').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –ø—Ä–æ—Ç–∏–≤ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?t=${Date.now()}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const allData = await response.json();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫—É –æ—Ç Google Script
                if (allData.error) throw new Error(allData.error);
                
                const user = tg.initDataUnsafe.user;
                userData = allData.find(row => String(row[0]) === String(user.id));
                
                if (userData) {
                    document.getElementById('status').innerHTML = `
                        <div class="status-item">
                            <span>Chat ID:</span>
                            <strong>${userData[0]}</strong>
                        </div>
                        <div class="status-item">
                            <span>–¢–µ–∫—É—â–∏–π —à–∞–≥:</span>
                            <strong style="color: #27ae60;">${userData[2]}</strong>
                        </div>
                        <div class="status-item">
                            <span>–ú–µ–Ω–µ–¥–∂–µ—Ä:</span>
                            <strong>${userData[4]}</strong>
                        </div>
                    `;
                } else {
                    document.getElementById('status').innerHTML = '<div style="color: #e74c3c;">–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                document.getElementById('status').innerHTML = `
                    <div style="color: #e74c3c;">
                        –û—à–∏–±–∫–∞: ${error.message}
                    </div>
                `;
            }
        };

        // –ó–∞–ø—É—Å–∫
        (async () => {
            await initUser();
            await loadData();
        })();
    </script>
</body>
</html>
