<!DOCTYPE html>
<html>
<head>
    <title>Личный кабинет</title>
    <script src="https://telegram.org/js/telegram-widget.js?22" 
            data-telegram-login="@EClid_bot" 
            data-size="large" 
            data-onauth="onTelegramAuth(user)">
    </script>
</head>
<body>
    <div id="user-data"></div>

    <script>
        function onTelegramAuth(user) {
            fetch('/auth', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    chat_id: user.id,
                    username: user.username
                })
            })
            .then(response => response.json())
            .then(data => {
                const html = `
                    <h1>Добро пожаловать, ${user.username}!</h1>
                    <p>Chat ID: ${user.id}</p>
                    <p>Статус: ${data['Статус клиента']}</p>
                    <p>Следующий шаг: ${data['Следующий шаг']}</p>
                    <p>Менеджер: ${data['Менеджер']}</p>
                `;
                document.getElementById('user-data').innerHTML = html;
            });
        }
    </script>
</body>
</html>
