<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π Telegram Mini App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
            padding: 20px;
        }
        button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
    <p id="user-info">–ó–∞–≥—Ä—É–∑–∫–∞...</p>

    <button onclick="downloadFile()">üìÇ –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª</button>
    <button onclick="goToBot()">ü§ñ –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥—Ä—É–≥–æ–π –±–æ—Ç</button>
    <button onclick="rateManager()">‚≠ê –û—Ü–µ–Ω–∏—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞</button>

    <script>
        async function getUserInfo() {
            const initData = window.Telegram.WebApp.initData;
            if (!initData) {
                document.getElementById("user-info").innerText = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.";
                return;
            }

            const urlParams = new URLSearchParams(initData);
            const chat_id = urlParams.get("user.id");
            const username = urlParams.get("user.username");

            const response = await fetch("/get_user", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ chat_id, username })
            });

            const data = await response.json();
            document.getElementById("user-info").innerHTML = `
                <strong>üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> @${data.username} <br>
                <strong>üìå –°—Ç–∞—Ç—É—Å:</strong> ${data.status} <br>
                <strong>‚û° –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:</strong> ${data.next_step} <br>
                <strong>üë®‚Äçüíº –ú–µ–Ω–µ–¥–∂–µ—Ä:</strong> ${data.manager}
            `;
        }

        function downloadFile() {
            window.open("https://example.com/file.pdf", "_blank");
        }

        function goToBot() {
            window.Telegram.WebApp.openTelegramLink("https://t.me/OtherBot");
        }

        function rateManager() {
            window.open("https://2gis.ru/", "_blank");
        }

        getUserInfo();
    </script>
</body>
</html>
